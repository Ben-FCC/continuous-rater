<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset='utf-8'>
	<meta name='viewport' content='width=device-width,initial-scale=1'>

	<title>Svelte app</title>

	<link rel='icon' type='image/png' href='/favicon.png'>
	<link rel='stylesheet' href='/global.css'>
	<link rel='stylesheet' href='/build/bundle.css'>

	<script defer src='/build/bundle.js'></script>

	<!-- the following component handles MTurk authentication -->
    <script type="text/javascript">
        import { buildVer } from './utils.js';
		function init() { // points 'attention' to url bar
		    function unescapeURL(s) {
			    return decodeURIComponent(s.replace(/\+/g, '%20'));
		    }
            var params = {};
            var url;
            var m;

            if (buildVer == 'demo') {
                url = "https://demo.app/?assignmentId=TEST&hitId=TEST&workerId=TEST";
                m = url.match(/[\\?&]([^=]+)=([^&#]*)/g);
            } else {
                url = window.location.href;
		        m = window.location.href.match(/[\\?&]([^=]+)=([^&#]*)/g);
            }
		
            if (m) {
                var i = 0;
                while (i < m.length) {
                    var a = m[i].match(/.([^=]+)=(.*)/);
                    params[unescapeURL(a[1])] = unescapeURL(a[2]);
                    i += 1;
                }
            }
		  // coming from somewhere other than MTurk
            if (!params.workerId && !params.assignmentId && !params.hitId) {
                var div = document.createElement('div');
                var content = document.createTextNode('Not authorized');
                div.appendChild(content);
                document.body.appendChild(div);
                console.log('non mturk referral');

		    } else if (params.assignmentId === 'ASSIGNMENT_ID_NOT_AVAILABLE') {
                var div = document.createElement('div');
                var content = document.createTextNode('Mturk ad');
                div.appendChild(content);
                document.body.appendChild(div);
                console.log('mturk preview');

			// this part is for successful authentication
		    } else {
                var app = document.createElement('script');
                app.setAttribute('src', 'bundle.js');
                document.body.appendChild(app);
                console.log('mturk accept');
		    }
		}
	  </script>
</head>

<body onLoad="init()">
</body>

</html>
